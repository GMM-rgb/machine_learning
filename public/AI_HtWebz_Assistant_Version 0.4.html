<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<link rel="shortcut icon" type="x-icon" href="HtWebz_AI_Assistant_Icon.png">
<head>
    <title>HtWebz Assistant</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: aquamarine;
        }
        body::-webkit-scrollbar {
            width: 12px;
            box-sizing: content-box;
        }
        body::-webkit-scrollbar-track {
            background: linear-gradient(cyan, aquamarine, cyan);
            border: 2px solid #ccc;
            border-radius: 50px;
        }
        body::-webkit-scrollbar-thumb {
            cursor: pointer;
            background: linear-gradient(aqua, rgb(8, 200, 200), darkcyan, rgb(8, 200, 200), aqua);
            border: 2px solid #ccc;
            border-radius: 50px;
        }
        body::-webkit-scrollbar-corner {
            background: radial-gradient(aqua, aquamarine, skyblue);
            border: 1px solid #ccc;
            border-radius: 25px;
        }
        .return-to-homepage-button {
            cursor: pointer;
            position: relative;
            border: 2px solid black;
            border-radius: 10px;
            background-color: red;
            -webkit-user-select: none;
            user-select: none;
            padding-inline: 21%;
            font-weight: bold;
            font-size: 2em;
            height: 60px;
            margin-left: 25px;
            color: rgb(139, 0, 0);
            text-wrap-mode: nowrap;
            box-shadow: 0 0 12.5px rgb(0, 0, 0);
            -webkit-transition: all 0.15s ease-in-out;
            transition: background-color 0.15s ease-in-out, color 0.35s ease-in-out, box-shadow 0.35s ease;
        }
        .return-to-homepage-button:hover {
            background-color: rgb(168, 1, 1);
            color: rgb(242, 114, 114);
            box-shadow: 0 0 25px rgb(0, 0, 0);
        }
        .page-title {
            display: block;
            margin-top: 12vh;
            -webkit-text-stroke: 2px darkcyan;
            -webkit-text-fill-color: cyan;
            -webkit-user-select: none;
            user-select: none;
            color: black;
            font-weight: bold;
            font-size: 3em;
        }
        .page-title-1 {
            display: none;
            flex: 1;
            position: static;
            margin-top: 30px;
            -webkit-text-stroke: 2px darkcyan;
            -webkit-text-fill-color: cyan;
            -webkit-user-select: none;
            user-select: none;
            color: black;
            font-weight: bold;
            font-size: 3em;
            box-sizing: border-box;
        }

        /* Left conversation list */
        #conversation-list {
            flex: 1;
            max-width: 250px;
            margin-right: 20px;
            background: lightblue;
            border: 4px solid #ccc;
            border-radius: 10px;
            padding: 10px;
            height: 420px;
            box-sizing: border-box;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .conversation-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px;
            background-color: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .conversation-item:hover {
            background-color: lightgray;
        }

        .conversation-item .buttons {
            margin-left: auto;
            display: flex;
            gap: 5px;
        }

        .notepad-icon {
            font-size: 24px;
            cursor: pointer;
            margin-bottom: 10px;
            border: 2px solid #ccc;
            border-top-left-radius: 10px;
            border-top-right-radius: 4.5px;
            border-bottom-left-radius: 4.5px;
            border-bottom-right-radius: 10px;
            background: repeating-linear-gradient(aquamarine, cyan, skyblue);
            padding: 3.5px;
        }
        .notepad-image-text {
            position: relative;
            margin-left: 2.5px;
            box-sizing: border-box;
            width: fit-content;
            height: fit-content;
            border: 1px dotted #ccc;
            border-radius: 3px;
            background: radial-gradient(aqua, aquamarine);
            flex: 3;
        }

        /*.deletion-button, .load-button {
            cursor: pointer;
            border: 1px solid #000;
            padding: 2px 5px;
            background-color: lightcoral;
            color: white;
            border-radius: 5px;
        }*/

        /* Chatbox styles */
        #chat-box {
            flex: 2;
            display: flex;
            flex-direction: column;
            background: cornflowerblue;
            border: 4px solid #ccc;
            border-radius: 10px;
            scroll-padding-right: 5px;
            padding: 20px;
            width: 635px;
            height: 372.5px;
            overflow-y: scroll;
            overflow-y: scroll;
            margin-bottom: 10px;
            text-wrap: stable;
            -webkit-text-wrap-mode: auto;
            text-wrap-mode: auto;
            box-shadow: 0 5.25px 11.5px rgba(0, 0, 0, 0.5);
            align-items: stretch;
            gap: 15px;
        }
        #chat-box::-webkit-scrollbar {
            width: 11.5px;
        }
        #chat-box::-webkit-scrollbar-track {
            background-color: darkcyan;
            border-radius: 35px;
            -webkit-transition: all 0.15s ease-in-out;
            transition: all 0.15s ease-in-out;
        }
        #chat-box::-webkit-scrollbar-thumb {
            cursor: pointer;
            background-color: aqua;
            border-radius: 35px;
            -webkit-transition: all 0.5s ease-in-out;
            transition: all 0.5s ease-in-out;
        }
        #chat-box::-webkit-scrollbar-thumb:hover {
            background-color: rgb(0, 182, 182);
        }
        #chat-box::-webkit-scrollbar-corner {
            background-color: cyan;
            border-radius: 35px;
            -webkit-transition: all 0.5s ease-in-out;
            transition: all 0.5s ease-in-out;
        }
        #user-input {
            width: 190px;
            border-width: 0.5px;
            border-color: lightgray;
            border-style: solid;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 2px solid black;
            outline: none;
            user-select: text;
        }
        .send-button {
            border: 2px solid black;
            border-radius: 10px;
            background-color: cyan;
            margin-right: 5px;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -webkit-transition: all 0.15s ease-in-out;
            transition: all 0.15s ease-in-out;
        }

        .send-button:hover {
            background-color: darkcyan;
        }

        .clear-button {
            cursor: pointer;
            font-weight: bold;
            border-left: 3px solid rgb(179, 179, 180);
            border-top: 3px solid rgb(179, 179, 180);
            border-bottom: 3px solid rgb(179, 179, 180);
            border-right: 3px solid rgb(179, 179, 180);
            background-color: red;
            border-radius: 5cap;
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4.25px 0px rgb(100, 100, 100);
        }

        .clear-button:hover {
            background-color: darkred;
        }

        .save-button {
            cursor: pointer;
            border-radius: 5cap;
            font-weight: bold;
            border-left: 3px solid rgb(179, 179, 180);
            border-top: 3px solid rgb(179, 179, 180);
            border-bottom: 3px solid rgb(179, 179, 180);
            border-right: 3px solid rgb(179, 179, 180);
            background-color: limegreen;
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4.25px 0px rgb(100, 100, 100);
        }

        .save-button:hover {
            background-color: green;
        }

        .load-button {
            cursor: pointer;
            border-radius: 5cap;
            background-color: #ff9d00;
            font-weight: bold;
            border-left: 3px solid rgb(179, 179, 180);
            border-top: 3px solid rgb(179, 179, 180);
            border-bottom: 3px solid rgb(179, 179, 180);
            border-right: 3px solid rgb(179, 179, 180);
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4.25px 0px rgb(100, 100, 100);
        }

        .load-button:hover {
            background-color: #ffbe3b;
        }
        .deletion-button {
            cursor: pointer;
            border-radius: 5cap;
            background-color: orangered;
            font-weight: bold;
            border-left: 3px solid rgb(179, 179, 180);
            border-top: 3px solid rgb(179, 179, 180);
            border-bottom: 3px solid rgb(179, 179, 180);
            border-right: 3px solid rgb(179, 179, 180);
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4.25px 0px rgb(100, 100, 100);
            box-sizing: border-box;
        }
        .deletion-button:hover {
            background-color: red;
        }
        #chat-section {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-direction: row;
            margin-top: -20px;
        }
        #messaging {
            padding-top: 10px;
        }
        #chat-user-control-interface {
            display: flex;
            gap: 4px;
            position: relative;
            padding-inline-start: 8.5px;
            padding-top: 1px;
            padding-bottom: 5px;
            border: 4px solid #ccc;
            border-radius: 10px;
            box-sizing: content-box;
            height: fit-content;
            width: fit-content;
            user-select: none;
            background: repeating-linear-gradient(lightblue, skyblue);
        }
        .create-new-chat-text {
            flex: auto;
            position: relative;
            font-weight: bold;
            text-align: center;
            margin-left: 12.5px;
            box-sizing: content-box;
            color: black;
            -webkit-text-stroke: 1px gray;
            -webkit-text-fill-color: lightgray;
        }
        .developer {
            position: relative;
            margin-top: 10px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 1.75em;
            font-weight: bold;
            list-style-position: inside;
            text-rendering: optimizeLegibility;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: black;
            -webkit-text-stroke: 2px darkcyan;
            -webkit-text-fill-color: cyan;
            user-select: none;
            -webkit-user-select: none;
        }
        #user-input:focus {
            border: 2px solid cyan;
        }
        /* Styles for chat messages */
        .chat-message {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            max-width: 80%;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.25s ease;
            box-shadow: 0 1.45px 6px rgb(0, 0, 0);
            position: relative;
            clear: both;
            margin: 10px 0;
        }

        .chat-message.user {
            float: right;
            margin-left: auto;
            flex-direction: row-reverse;
            background: radial-gradient(lightcyan, lightblue, skyblue);
            border: 3px solid #ccc;
        }

        .chat-message.ai, 
        .chat-message.system {
            float: left;
            margin-right: auto;
            background: radial-gradient(lightgreen, rgb(133, 251, 133), lightgreen);
            border: 3px solid #ccc;
        }

        .chat-message.user img {
            margin-left: 0;
            margin-right: 10px;
            width: 40px;
            height: 40px;
            border: 2px solid #ccc;
            border-radius: 10px;
        }
        .chat-message.ai img {
            margin-left: 0;
            margin-right: 10px;
            width: 40px;
            height: 40px;
            border: 2px solid #ccc;
            border-radius: 10px;
        }
        .chat-message.system img {
            margin-left: 0;
            margin-right: 10px;
            width: 40px;
            height: 40px;
            border: 2px solid #ccc;
            border-radius: 10px;
        }

        .thinking-container {
            display: none;
            align-self: flex-start;
            margin-top: auto; /* Push to bottom of chat box */
            position: sticky; /* Keep visible while scrolling */
            bottom: 0;
            width: calc(40% - 40px); /* Account for padding */
            margin: 10px;
            padding: 10px;
            background: radial-gradient(circle at center, #b3ffff, #80ffff);
            border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
            z-index: 100; /* Ensure it stays on top */
        }

        .thinking-text {
            color: darkcyan;
            font-weight: bold;
            font-size: 1.1em;
            display: inline-block;
            animation: ripple 1.5s infinite;
        }

        .thinking-dots {
            display: inline-block;
        }

        .thinking-dot {
            display: inline-block;
            margin: 0 2px;
            animation: bounce 1.4s infinite;
        }

        .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
        .thinking-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes ripple {
            0% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
            100% { transform: translateY(0); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        #chat-box {
            display: flex;
            flex-direction: column;
            gap: 16px;  /* Consistent spacing between messages */
            padding: 20px;
        }

        .message-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            margin: 0;
        }

        .chat-message {
            position: relative;
            display: flex;
            align-items: flex-start;
            max-width: 80%;
            margin: 0;  /* Remove default margins */
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Update message alignment styles */
        .chat-message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .chat-message.ai,
        .chat-message.system {
            align-self: flex-start;
        }

        .thinking-container {
            align-self: flex-start;
            margin: 8px 0;
        }
        /* Update chat box styles */
        #chat-box {
            display: flex;
            flex-direction: column;
            gap: 24px;  /* Increased gap between messages */
            padding: 20px;
        }

        .chat-message {
            display: flex;
            align-items: flex-start;
            max-width: 75%;
            padding: 12px;
            border-radius: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            margin: 0;  /* Remove default margins */
            position: relative;
            animation: messageSlide 0.3s ease-out;
        }

        .chat-message.user {
            margin-left: 12.5%;  /* Push user messages to the right */
            align-self: flex-end;
            flex-direction: row-reverse;
            background: radial-gradient(lightcyan, lightblue, skyblue);
            border: 3px solid #ccc;
            transform-origin: right bottom;
        }

        .chat-message.ai,
        .chat-message.system {
            margin-right: 12.5%;  /* Push AI messages to the left */
            align-self: flex-start;
            background: radial-gradient(lightgreen, rgb(133, 251, 133), lightgreen);
            border: 3px solid #ccc;
            transform-origin: left bottom;
        }

        @keyframes messageSlide {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Update message spacing for consecutive messages */
        .chat-message + .chat-message {
            margin-top: 16px;  /* Add space between consecutive messages */
        }

        .chat-message.user + .chat-message.ai,
        .chat-message.ai + .chat-message.user {
            margin-top: 24px;  /* Add extra space when switching sides */
        }
        /* Update message spacing styles */
        #chat-box {
            display: flex;
            flex-direction: column;
            gap: 0;  /* Remove default gap */
            padding: 20px;
        }

        .message-spacer {
            height: 24px;  /* Space between messages */
            width: 100%;
        }

        .chat-message {
            display: flex;
            align-items: flex-start;
            max-width: 75%;
            padding: 12px;
            margin: 0;
            border-radius: 15px;
            animation: slideInMessage 0.3s ease-out;
            position: relative;
        }

        @keyframes slideInMessage {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Remove previous margin styles */
        .chat-message.user,
        .chat-message.ai,
        .chat-message.system {
            margin: 0;
        }
#chat-box {
    display: flex;
    flex-direction: column;
    gap: 16px;  /* Consistent spacing between messages */
    padding: 20px;
}

.chat-message {
    display: flex;
    align-items: flex-start;
    max-width: 75%;
    padding: 12px;
    border-radius: 15px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    margin: 0;
    position: relative;
    animation: slideInMessage 0.3s ease-out;
    word-wrap: break-word;  /* Ensure long messages wrap */
}

.chat-message.user {
    align-self: flex-end;
    flex-direction: row-reverse;
    background: radial-gradient(lightcyan, lightblue, skyblue);
    border: 3px solid #ccc;
}

.chat-message.ai,
.chat-message.system {
    align-self: flex-start;
    background: radial-gradient(lightgreen, rgb(133, 251, 133), lightgreen);
    border: 3px solid #ccc;
}

@keyframes slideInMessage {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Ensure proper spacing between messages */
.chat-message + .chat-message {
    margin-top: 24px;  /* Add space between consecutive messages */
}
</style>
</head>
<body>
    <audio id="sendMessage-audio" src="../Audio_Assets/SendSoundEffect.mp3"></audio>
    <div id="return-to-homepage">
        <style>
            #return-to-homepage {
                position: fixed;
                flex: 1;
                top: 0;
                left: 0;
                z-index: 1000;
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-content: center;
                align-items: center;
                padding: 10px;
                background: linear-gradient(to right, cyan, aquamarine, cyan);
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
                opacity: 0.875;
                border: 2px solid #ccc;
                border-bottom-left-radius: 7.5px;
                border-bottom-right-radius: 7.5px;
                box-sizing: border-box;
                transition: all 0.25s ease;
            }
            #minimize-return-button {
                position: absolute;
                top: 50%;
                left: 2.5px;
                transform: translateY(-50%);
                width: 30px;
                height: 30px;
                background: cyan;
                border: 2px solid black;
                border-radius: 50%;
                font-size: 1.5em;
                font-weight: bold;
                text-align: center;
                line-height: 0;
                color: black;
                cursor: pointer;
                transition: background 0.15s ease-in, color 0.15s ease-in;
            }
            #minimize-return-button::before {
                content: '';
                transform: translateY(-50%);
            }
            #minimize-return-button:hover {
                background: darkcyan;
                color: white;
            }
            #minimize-return-button-one {
                display: none;
                position: fixed;
                top: 0;
                left: 5px;
                transform: translateY(5%);
                width: 30px;
                height: 30px;
                background: cyan;
                border: 2px solid black;
                border-radius: 25px;
                font-size: 1.5em;
                font-weight: bold;
                text-align: center;
                line-height: 1;
                color: black;
                cursor: pointer;
                box-sizing: content-box;
                width: fit-content;
                z-index: 105;
                opacity: 0.6;
                transition: background 0.15s ease-in, color 0.15s ease-in;
            }
            #minimize-return-button-one:hover {
                background: darkcyan;
                color: white;
            }
        </style>
        <!--<button id="login-account">Login</button><button id="register-account">Register</button>-->
        <button class="return-to-homepage-button" id="return-to-homepage-button" onclick="returnToHomepage()">Return to Homepage</button>
        <h1 class="page-title-1">HtWebz Assistant</h1>
        <button id="minimize-return-button"><</button>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const minimize = document.getElementById('minimize-return-button');
                const minimizetwo = document.getElementById('minimize-return-button-one');
                const returnContainer = document.getElementById('return-to-homepage');
                const pageT = document.getElementById('page-title');
        
                function wait(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }
                
                minimize.addEventListener('click', minimizeReturnButton => {
                    returnContainer.style.opacity = '0';
                    wait(250).then(() => {
                        returnContainer.style.display = 'none';
                        minimizetwo.style.display = 'block';
                    });
                });
        
                minimizetwo.addEventListener('click', unminimizeReturnButton => {
                    returnContainer.style.display = 'flex';
                    minimizetwo.style.display = 'none';
                    wait(50).then(() => {
                        returnContainer.style.opacity = '1';
                    });
                });
            });
        </script>    
    </div>
    <button id="minimize-return-button-one">Show Toolbar</button>
    <h1 class="page-title">HtWebz Assistant</h1>

<section id="chat-section">
    <!-- Conversation List on Left -->
    <div id="conversation-list">
        <div class="notepad-icon" onclick="startNewChat()"><text class="notepad-image-text">üìù</text> <text class="create-new-chat-text">Create New</text></div>
    </div>
    <!-- Chat Box -->
    <div id="chat-box">
        <div class="thinking-container">
            <span class="thinking-text">AI is thinking</span>
            <span class="thinking-dots">
                <span class="thinking-dot">.</span>
                <span class="thinking-dot">.</span>
                <span class="thinking-dot">.</span>
            </span>
        </div>
    </div>
</section>

    <!-- Input Area -->
    <div id="chat-user-control-interface">
        <form onsubmit="event.preventDefault(); sendMessage();" id="messaging">
            <input type="text" id="user-input" placeholder="Type a message..." autocomplete="off" autofocus="onload" />
            <button class="send-button" type="submit">Send</button>
        </form>
        <style>
            #command-container {
                display: none;
                pointer-events: none;
                position: absolute;
                margin-top: -50px;
            }
            .command {
                position: relative;
                display: inline-block;
                pointer-events: all;
                margin-top: 0;
                margin-left: 0;
                padding: 5px;
                border: 2px solid black;
                border-radius: 5px;
                background-color: lightblue;
                color: black;
                font-weight: bold;
                font-size: 1.25em;
                cursor: pointer;
                box-shadow: 0 0 2.75px rgba(0, 0, 0, 0.5);
                transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
            }
        </style>
        <div id="command-container">
            <ul style="cursor: pointer;" class="command" onclick="">/start</ul>
            <ul style="cursor: pointer;" class="command" onclick="">/stop</ul>
            <ul style="cursor: pointer;" class="command" onclick="">/help</ul>
            <ul style="cursor: pointer;" class="command" onclick="">/clear</ul>
        </div>
        <script>
            const commands = document.querySelectorAll('.command');
            const userInput = document.getElementById('user-input');
            const commandContainer = document.getElementById('command-container');

            // Function to highlight matching letters in commands
            function highlightCommand(command, input) {
                const commandText = command.innerText;
                const regex = new RegExp(`(${input})`, 'gi');
                command.innerHTML = commandText.replace(regex, '<span style="color: red;">$1</span>');
            }

            // Function to show or hide commands based on user input
            function toggleCommands() {
                const input = userInput.value;
                if (input.startsWith('/')) {
                    commandContainer.style.display = 'block';
                    commands.forEach(command => {
                        if (command.innerText.startsWith(input)) {
                            command.style.display = 'inline-block';
                            highlightCommand(command, input);
                        } else {
                            command.style.display = 'none';
                        }
                    });
                } else {
                    commandContainer.style.display = 'none';
                }
            }

            // Event listener for user input
            userInput.addEventListener('input', toggleCommands);

            // Event listener for command click
            commands.forEach(command => {
                command.addEventListener('click', () => {
                    const commandText = command.innerText;
                    userInput.value = commandText;
                    sendMessage();
                });
            });
        </script>
        <button class="clear-button" id="clear-button" onclick="clearChat()">Clear Chat</button>
        <button class="save-button" id="save-button" onclick="saveData()">Save Data</button>
        <button class="load-button" id="load-button" onclick="document.getElementById('file-input').click();">Upload Data</button>
        <input type="file" id="file-input" style="display: none;" onchange="loadData(event)" />
        <text id="current-chat-display"></text>
    </div>

    <footer class="developer">Made by: Maximus Farvour</footer>

    <script>
        const usrIn = document.getElementById('user-input');
        
        usrIn.addEventListener('focus', () => {
            usrIn.placeholder = 'Typing...';
        });
    
        usrIn.addEventListener('blur', () => {
            usrIn.placeholder = 'Type a message...';
        });
    </script>    
    <style>
        .chat-message {
            font-family: Arial, sans-serif;
            font-size: 18.5px;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        #current-chat-display {
            display: none;
            font-weight: bold;
            font-size: 1.45em;
            margin-left: 10px;
            margin-top: 8.75px;
            color: black;
            -webkit-text-stroke: 1px gray;
            -webkit-text-fill-color: lightgray;
        }
    
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
    
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>    

    <script src="button_effect.js"></script>

    <!--<script>
        document.body.addEventListener('mousedown', draggingScrollbar => {
            if(document.body.style.curosr === 'grab' || document.body.style.cursor) {
                document.body.style.cursor = 'grabbing';
            }
        });
    </script>-->

    <script>
        const returnButton = document.getElementById('return-to-homepage-button');

        returnButton.addEventListener('click', navigateToPage => {
            window.location.href = '../../index.html';
        });
    </script>
<script>
const chatBox = document.getElementById('chat-box');
const sendButton = document.getElementById('send-btn');
const clearButton = document.getElementById('clear-btn');
const conversationList = document.getElementById('conversation-list');
const ccd = document.getElementById('current-chat-display');
const cinf = document.getElementById('chat-user-control-interface');
let currentChatId = null;
let conversationData = JSON.parse(localStorage.getItem('conversations')) || {}; // Load conversations from localStorage
// Flag to determine if the chat box should be scrolled to the bottom
let isScrollLocked = true;

// Function to create a new chat and add it to the conversation list
function startNewChat() {
    const chatId = `Chat ${Object.keys(conversationData).length + 1}`;
    currentChatId = chatId;
    conversationData[chatId] = [];
    saveConversations();

    const conversationItem = document.createElement('div');
    conversationItem.classList.add('conversation-item');
    conversationItem.dataset.chatId = chatId;

    conversationItem.innerHTML = `
        <span>${chatId}</span>
        <div class="buttons">
            <button class="load-button" onclick="loadChat('${chatId}')">Load</button>
            <button class="deletion-button" onclick="deleteChat('${chatId}')">Delete</button>
        </div>
    `;
    conversationList.appendChild(conversationItem);
    loadChat(chatId);
}

// Load conversation based on the selected chat ID
function loadChat(chatId) {
    if (currentChatId === chatId) return; // Avoid duplicate loading
    currentChatId = chatId;

    // Clear the chat box
    chatBox.innerHTML = '';

    // Append all messages from the selected conversation without duplicating
    if (conversationData[chatId]) {
        conversationData[chatId].forEach((message, index) => {
            appendMessage(message.sender, message.text, false); // Prevent re-saving on load
        });
        ccd.style.display = 'block';
        ccd.innerText = `Current Chat: ${chatId}`;
        cinf.style.paddingRight = '10px';

        // Scroll to the bottom of the chat box
        chatBox.scrollTop = chatBox.scrollHeight;
    }
}

// Delete a conversation from the list
function deleteChat(chatId) {
    delete conversationData[chatId];
    saveConversations();

    const chatItem = document.querySelector(`[data-chat-id="${chatId}"]`);
    conversationList.removeChild(chatItem);

    if (currentChatId === chatId) {
        chatBox.innerHTML = '';
        currentChatId = null;
    }
}

// Function to append message with proper positioning
function appendMessage(sender, message, saveToData = true) {
    const timestamp = new Date().getTime();
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('chat-message', sender.toLowerCase());
    
    if (sender.toLowerCase() === 'user') {
        messageDiv.innerHTML = `
            <div class="message-content">
                <strong>${sender}:</strong> ${message.replace(/\n/g, '<br>')}
            </div>
            <img src="Image_Assets/${sender.toLowerCase()}_profile.png?${timestamp}" alt="${sender} Profile">
        `;
    } else {
        messageDiv.innerHTML = `
            <img src="Image_Assets/${sender.toLowerCase()}_profile.png?${timestamp}" alt="${sender} Profile">
            <div class="message-content">
                <strong>${sender}:</strong> ${message.replace(/\n/g, '<br>')}
            </div>
        `;
    }

    // Insert message
    chatBox.appendChild(messageDiv);

    // Ensure smooth scroll
    setTimeout(() => {
        chatBox.scrollTop = chatBox.scrollHeight;
    }, 100);

    if (saveToData && currentChatId) {
        conversationData[currentChatId].push({ sender, text: message });
        saveConversations();
    }
}

function typeOutMessage(sender, message) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('chat-message', sender.toLowerCase());
    
    messageDiv.innerHTML = `
        <img src="../Image_Assets/${sender.toLowerCase()}_profile.png" alt="${sender} Profile">
        <div class="message-content">
            <strong>${sender}:</strong> <span class="fade-in"></span>
        </div>
    `;
    
    chatBox.appendChild(messageDiv);
    const messageSpan = messageDiv.querySelector('span');
    
    // Typing animation code, simulate typing effect
    let i = 0;
    let typingSpeed = message.length > 200 ? 6.35 : message.length > 100 ? 16.25 : message.length > 50 ? 19.5 : 22.5;

    function type() {
        if (i < message.length) {
            if (message.charAt(i) === '\n') {
                messageSpan.innerHTML += '<br>';
            } else {
                messageSpan.innerHTML += message.charAt(i);  // Use innerHTML to render HTML content
            }
            i++;
            setTimeout(type, typingSpeed);
            chatBox.scrollTop = chatBox.scrollHeight;
        } else if (currentChatId) {
            conversationData[currentChatId].push({ sender, text: message });
            saveConversations();
        }
    }

    type();
}

// Add a style to ensure proper message flow
const style = document.createElement('style');
style.textContent = `
    #chat-box {
        display: flex;
        flex-direction: column;
    }
    #chat-box::after {
        content: '';
        clear: both;
        display: table;
    }
    .chat-message {
        max-width: 80%;
        margin-bottom: 15px;
    }
`;
document.head.appendChild(style);

// Send message to server
let isSending = false;
const sendMessage = async () => {
    if (isSending) return;
    isSending = true;

    const message = userInput.value.trim();
    if (!message) {
        isSending = false;
        return;
    }

    if (!currentChatId) {
        startNewChat();
    }

    appendMessage('User', message);
    userInput.value = '';

    // Reset chat box HTML with thinking container
    const thinkingContainer = document.querySelector('.thinking-container');
    if (!thinkingContainer) {
        chatBox.innerHTML += `
            <div class="thinking-container">
                <span class="thinking-text">AI is thinking</span>
                <span class="thinking-dots">
                    <span class="thinking-dot">.</span>
                    <span class="thinking-dot">.</span>
                    <span class="thinking-dot">.</span>
                </span>
            </div>
        `;
    }
    const thinking = chatBox.querySelector('.thinking-container');
    thinking.style.display = 'block';
    chatBox.scrollTop = chatBox.scrollHeight;

    try {
        // Add minimum delay for thinking animation
        await new Promise(resolve => setTimeout(resolve, 1500));

        if (message === '/start') {
            const response = await fetch('http://localhost:3000/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
            });

            if (!response.ok) throw new Error('Failed to start server');

            const data = await response.json();
            thinking.style.display = 'none';
            typeOutMessage('System', data.response);
        } else {
            const response = await fetch('http://localhost:3000/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message }),
            });

            if (!response.ok) throw new Error('Failed to process message');

            const data = await response.json();
            thinking.style.display = 'none';
            if (data && data.response) {
                typeOutMessage('AI', data.response);
            } else {
                throw new Error('Invalid response from server');
            }
        }
    } catch (error) {
        console.error('Error:', error);
        thinking.style.display = 'none';
        typeOutMessage('System', 'Error: Unable to process message. Please try again.');
    } finally {
        isSending = false;
    }
}

// Clear chat display without modifying stored data
function clearChat() {
    chatBox.innerHTML = '';
    chatBox.scrollTop = 0; // Reset scroll position
}

// Clear chat display without modifying stored data
function clearChat() {
    chatBox.innerHTML = '';
    chatBox.scrollTop = 0; // Reset scroll position
}

// Save conversations to localStorage
function saveConversations() {
    localStorage.setItem('conversations', JSON.stringify(conversationData));
}

// Initialize conversation list from localStorage
function initializeConversations() {
    for (const chatId in conversationData) {
        const conversationItem = document.createElement('div');
        conversationItem.classList.add('conversation-item');
        conversationItem.dataset.chatId = chatId;

        conversationItem.innerHTML = `
            <span>${chatId}</span>
            <div class="buttons">
                <button class="load-button" onclick="loadChat('${chatId}')">Load</button>
                <button class="deletion-button" onclick="deleteChat('${chatId}')">Delete</button>
            </div>
        `;
        conversationList.appendChild(conversationItem);
    }
}

// Initialize on page load
initializeConversations();

// Event listeners
sendButton.addEventListener('click', sendMessage);
clearButton.addEventListener('click', clearChat);

// Disable scroll lock when the user manually scrolls
chatBox.addEventListener('scroll', () => {
    if (chatBox.scrollTop + chatBox.clientHeight < chatBox.scrollHeight) {
        isScrollLocked = false;
    } else {
        isScrollLocked = true;
    }
});
</script>
</body>
<style>
    body {
      background: aquamarine;
    }
    .context-menu {
      display: none;
      position: fixed;
      background: radial-gradient(circle, #22c6e3, #077082);
      border: 2px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 1px 15px rgba(24, 188, 217, 0.95);
      z-index: 1000;
  }
  
  .context-menu ul {
      list-style: none;
      font-family: Sans-Serif;
      font-weight: bold;
      -webkit-user-select: none;
      user-select: none;
      padding: 10px;
      margin: 0;
  }
  
  .context-menu li {
      padding: 8px 12px;
      border-radius: 0.25cm;
      cursor: pointer;
      transition: all 0.15s ease;
  }
  
  .context-menu li:hover {
      background-color: aqua;
  }
  .context-menu .disabled { color: #ccc; pointer-events: none; }  .context-menu .link-option { display: none; }      </style>  </head>  <body>      <div id="myMenu" class="context-menu">          <ul>              <li id="copy">Copy</li>              <li id="paste">Paste</li>              <li id="reload">Reload</li>              <li id="openNewTab" class="link-option">Open Link in New Tab</li>               <li id="openNewWindow" class="link-option">Open Link in New Window</li>              <li id="inspect">Inspect</li>              <li id="viewSource">View Page Source</li>          </ul>      </div>  <script src="context_menu.js"></script>
</html>
